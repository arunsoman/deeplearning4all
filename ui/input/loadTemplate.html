<script>
window.customElements.define('load-template' ,class extends HTMLElement {
  constructor() {
    super();
    this.template = document.createElement('template');
    this.template.innerHTML = `
      <button
        id="button"
        type="button">Click Me Dummy!</button>
    `
    this.attachShadow({mode: 'open'});
    let _ = this;

    this.loadBlocks=function (toggle) {
        let xml_texts = [
          `<xml xmlns="http://www.w3.org/1999/xhtml"><variables><variable type="" id="a#v@N!10;Y3vwEbQpO|E">model1</variable><variable type="" id=".90!~a@Z_,Mh.h1a;vRW">shape1</variable><variable type="" id="H_hXcN*BYLQc:cUVolu2">train1</variable></variables><block type="program" id="C;ToC*@B+}t1.YqJl3x?" x="585" y="-143"><statement name="operation"><block type="variables_set" id=",s42Aomu;O$t9h^m|L$j"><field name="VAR" id="a#v@N!10;Y3vwEbQpO|E" variabletype="">model1</field><value name="VALUE"><block type="supervised_models" id="?EuwhDXHX?|TW!(=d,dV"><field name="type">SVM Regression</field><field name="shape">2,2</field><value name="Config"><block type="text" id="\`d)*Q=S??z;$!CkZ\`hcr"><field name="TEXT"></field></block></value></block></value><next><block type="variables_set" id="6Japhuq;O[^-2,yDuk\`9"><field name="VAR" id=".90!~a@Z_,Mh.h1a;vRW" variabletype="">shape1</field><value name="VALUE"><block type="shaper" id="Ui@l9w.1*z,PpP)wEegA"><field name="input columns">*</field><field name="xdimension">1</field><field name="output columns">-1</field><field name="ydimension">1</field><field name="yoffset">0</field><field name="test data">20</field><value name="shaper_xinput_csv"><block type="csv_reader" id="Dwpnj%vfUw-a#KbA[E;M"><field name="url">ftp://</field><field name="uri">/</field><field name="config">default</field><field name="streamType">csv</field><field name="columns"></field><value name="Transformers"><block type="lists_create_with" id="eCgII5R?P0jK0EtRf3kO"><mutation items="1"></mutation><value name="ADD0"><block type="transformer" id="MF]I/ivecMQra]m^5NED"><field name="column">0</field><field name="function">plus1</field></block></value></block></value></block></value><value name="shaper_yinput_csv"><block type="csv_reader" id="a3ZNg9k5?sqOB9AQBF;L"><field name="url">ftp://</field><field name="uri">/</field><field name="config">default</field><field name="streamType">csv</field><field name="columns"></field><value name="Transformers"><block type="lists_create_with" id="N/%jc:?R^+lW7lZ?1wMs"><mutation items="1"></mutation><value name="ADD0"><block type="transformer" id="\`1=[~_o5,JB2Rhr3n\`Ek"><field name="column">0</field><field name="function">plus1</field></block></value></block></value></block></value></block></value><next><block type="variables_set" id="4HWUZ(\`!+xJ!m0A,I+l1"><field name="VAR" id="H_hXcN*BYLQc:cUVolu2" variabletype="">train1</field><value name="VALUE"><block type="train" id="W6^KH\`99ZJt6(OxE!Bc["><field name="show result">TRUE</field><value name="Model"><block type="variables_get" id="ZCa;xzoZp4~i;Ic|kkA:"><field name="VAR" id="a#v@N!10;Y3vwEbQpO|E" variabletype="">model1</field></block></value><value name="shaper"><block type="norm" id="Ct]}$jcNDLGBFlcZ?31L"><value name="data"><block type="variables_get" id="Gu2}v;YUc-V(fJp7TA^="><field name="VAR" id=".90!~a@Z_,Mh.h1a;vRW" variabletype="">shape1</field></block></value><value name="normalizer"><block type="normalizer" id="r;m/PqEs?X54wLtt;Tse"><field name="range">-1,1</field></block></value></block></value></block></value><next><block type="csv_writer" id="Nib1zjqz75UL19dy~7wb"><field name="writer_uri_var">default</field><value name="writer_input"><block type="denorm" id="\`xf.yM0~dkI:2K7P(www"><field name="axis">x</field><value name="data"><block type="predict" id="bBJWIKsbIWYjninmAEJ-"><field name="predict_model" id="a#v@N!10;Y3vwEbQpO|E" variabletype="">model1</field><value name="Shape"><block type="variables_get" id="*bg*GK|*!]~5-wpSD_#o"><field name="VAR" id=".90!~a@Z_,Mh.h1a;vRW" variabletype="">shape1</field></block></value></block></value><value name="normalizer"><block type="normalizer" id="={mmi/s|k)04(Ym?l2#~"><field name="range">-1,1</field></block></value></block></value></block></next></block></next></block></next></block></statement></block></xml>`,
          ]
      return function(event) {
        const result = _.attributes.watch.value.split(' ')
          .map((e) => e + ":" + document.getElementById(e)[_.attributes.query.value])
        console.log(result)
        _.bb.attachBlock()

        let xml_text = 0;
        switch (result){
          case 'tech:super-lp,process:csv':
            xml_text=0;
        }
        const xml = Blockly.Xml.textToDom(xml_texts[xml_text]);
        Blockly.Xml.domToWorkspace(xml, _.bb.workspace);
        _.shadowRoot.firstElementChild.innerText = "Get code";
        _.button.onclick = toggle()
      }
    }
  }



  connectedCallback(){
    let _ = this;
    _.shadowRoot.appendChild(
        this.template.content.cloneNode(true));
    _.button = _.shadowRoot.querySelector('button');
    _.bb = document.getElementById(_.attributes.update.value.split(" ")[0])
    //_.bb.ready=function(){

   // }

    const toggle = function (){
      const editor = document.getElementById('pyeditor');
      const bb = _.bb;
      let showCode = function () {
        bb.hidden = true;
        editor.showcode(bb.getCode())
        editor.hidden = ""
        _.shadowRoot.firstElementChild.innerText="show blocks";
        _.button.onclick =showBlock
      }
      let showBlock = function () {
        bb.hidden = '';
        editor.showcode('')
        editor.hidden = "true"
        _.shadowRoot.firstElementChild.innerText="show code";
        _.button.onclick =showCode
      }
      let flag = 1;
      return function (){
        return showCode
      }
    }
    _.button.onclick = _.loadBlocks(toggle())
  }
});
</script>
